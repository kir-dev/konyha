%h2.text-2xl.md:text-4xl.w-full
  %strong Eszköz

.mt-4.bg-white.rounded-lg
  .p-4.grid.grid-cols-2
    %strong.col-span-2.md:col-span-1.p-1.md:p-2.md:border-b.md:border-gray-300
      Elnevezés
    .col-span-2.md:col-span-1.p-1.md:p-2.border-b.border-gray-300
      = @appliance.name
    %strong.col-span-1.p-1.md:p-2.border-b.border-gray-300
      Típusa
    .col-span-1.p-1.md:p-2.border-b.border-gray-300
      = @appliance.category
    %strong.col-span-1.p-1.md:p-2.border-b.border-gray-300
      Állapota
    .col-span-1.p-1.md:p-2.border-b.border-gray-300
      - if @appliance.status == "broken"
        .text-red-500= t @appliance.status
      - else
        .text-green-500= t @appliance.status
    %strong.col-span-1.p-1.md:p-2.border-b.border-gray-300
      Konyha:
    .col-span-1.p-1.md:p-2.border-b.border-gray-300
      = "#{@appliance.kitchen.floor}. szint"
    %strong.col-span-2.md:col-span-1.p-1.md:p-2.border-b.border-gray-300
      Leírás
    .col-span-2.md:col-span-1.p-1.md:p-2.border-b.border-gray-300
      = @appliance.description
    %strong.col-span-2.md:col-span-1.p-1.md:p-2
      Tulajdonos
    .col-span-2.md:col-span-1.p-1.md:p-2.text-blue-600
      = link_to @appliance.owner.name, user_path(@appliance.owner), class: "hover:underline"
= render "status_transition", appliance: @appliance

%body.bg-gray-200.flex.items-center.justify-center.h-screen
%button.modal-open.my-10.shadow.bg-blue-500.hover:bg-blue-600.focus:shadow-outline.focus:outline-none.text-white.font-bold.py-2.px-4.rounded Jelentés hozzaadasa

.my-4.flex.flex-wrap
  .flex-1.my-2
    = link_to 'Vissza', kitchen_path(@appliance.kitchen), class: "bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded"
  .flex-1.text-right.my-2
    = link_to 'Módosítás', edit_appliance_path(@appliance), class: "bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded"

- unless @appliance.comments.empty?
  .my-4.text-xl.md:text-2xl
    Jelentések:

- @appliance.comments.reverse.each do |comment|
  .transition-all.duration-150.px-2.py-2
    .flex.flex-col.items-stretch.min-h-full.pb-4.mb-1.transition-all.duration-150.bg-white.rounded-lg.shadow.hover:shadow-lg
      .grid.grid-cols-3.px-3.py-2
        - color = "text-green-500" if comment.category == "fix"
        - color = "text-red-500" if comment.category == "problem"
        .col-span-1.text-sm.uppercase.font-bold.py-1{class: "#{color}"}
          = t comment.category
        .col-span-2.md:grid.md:grid-cols-2.py-1
          .text-sm.text-right.md:text-center
            = l comment.created_at, format: :short
          .text-sm.font-medium.text-blue-600.text-right
            = link_to comment.owner.name, user_path(comment.owner), class: "hover:underline"
      %hr.border-gray-30
      = link_to appliance_comment_path(comment) do
        %p.flex.flex-row.flex-wrap.w-full.px-5.py-2.text-sm.text-justify
          = comment.body


%link{:href => "https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css", :rel => "stylesheet"}/
:css
  .modal {
    transition: opacity 0.25s ease;
  }
  body.modal-active {
    overflow-x: hidden;
    overflow-y: visible !important;
  }


/ Modal
.modal.opacity-0.pointer-events-none.fixed.w-full.h-full.top-0.left-0.flex.items-center.justify-center
  .modal-overlay.absolute.w-full.h-full.bg-gray-900.opacity-50
  .modal-container.bg-white.md:max-w-md.mx-10.rounded.shadow-lg.z-50.overflow-y-auto{:class => "w-10/12"}
    .modal-close.absolute.top-0.right-0.cursor-pointer.flex.flex-col.items-center.mt-4.mr-4.text-white.text-sm.z-50
      %svg.fill-current.text-white{:height => "18", :viewbox => "0 0 18 18", :width => "18", :xmlns => "http://www.w3.org/2000/svg"}
        %path{:d => "M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"}
      %span.text-sm (Esc)
    / Add margin if you want to see some of the overlay behind the modal
    .modal-content.py-4.text-left.px-6
      / Title
     
      .title
        %h2.text-center-3xl.font-semibold.text-gray-800.md:text-4xl
          Segits a szintet
          %span.text-orange-400 uptodate
          %span.text-3xl.font-semibold.text-gray-800.md:text-4xl tartani
        %h2.text-xl.md:text-xl.w-full
          %strong Tolts fel egy uj jelentest 
          %span.text-xs.font-semibold.inline-block.py-1.px-2.uppercase.rounded-full.text-orange-600.bg-orange-200.uppercase.last:mr-0.mr-1 NEW
      
      .form.mt-4
        .flex.flex-col.text-sm
        .w-full.mt-8
          = render 'appliance_comments/compact_form', appliance_comment: @new_appliance_comment

      / Footer
      .flex.justify-end.pt-2
        %button.modal-close.px-4.bg-blue-600.p-3.rounded-lg.text-white.hover:bg-blue-500 Close
  :javascript
    var openmodal = document.querySelectorAll('.modal-open')
    for (var i = 0; i < openmodal.length; i++) {
      openmodal[i].addEventListener('click', function(event){
      event.preventDefault()
      toggleModal()
      })
    }
    
    const overlay = document.querySelector('.modal-overlay')
    overlay.addEventListener('click', toggleModal)
    
    var closemodal = document.querySelectorAll('.modal-close')
    for (var i = 0; i < closemodal.length; i++) {
      closemodal[i].addEventListener('click', toggleModal)
    }
    
    document.onkeydown = function(evt) {
      evt = evt || window.event
      var isEscape = false
      if ("key" in evt) {
      isEscape = (evt.key === "Escape" || evt.key === "Esc")
      } else {
      isEscape = (evt.keyCode === 27)
      }
      if (isEscape && document.body.classList.contains('modal-active')) {
      toggleModal()
      }
    };
    
    
    function toggleModal () {
      const body = document.querySelector('body')
      const modal = document.querySelector('.modal')
      modal.classList.toggle('opacity-0')
      modal.classList.toggle('pointer-events-none')
      body.classList.toggle('modal-active')
    }
